---
description: Generate React code directly from Figma MCP (no external tools)
---

# Generate Code from Figma (Strict Mode)

Generate pixel-perfect React code from Figma design with mandatory verification gates.

**CRITICAL: Process does NOT end until ALL gates pass.**

---

## Arguments

- **Page Name**: Page to generate - e.g., "Homepage", "O_kampanii"

## Prerequisites

1. `/1-analyze-project` completed - `implementation-status.md` exists
2. `/2-analyze-page` completed - implementation plan exists
3. `FIGMA_ACCESS_TOKEN` set in `.env`
4. Dev server ready: `npm run dev`

---

## Workflow Overview

```
PHASE 0: Component Inventory ‚Üí GATE 0 (Component Extensions)
    ‚Üì
PHASE 1: Preparation
    ‚Üì
PHASE 2: Asset Extraction ‚Üí GATE 1 (Asset Verification)
    ‚Üì
PHASE 3: Per-Component Generation ‚Üí GATE 2 (Per-Component Verification)
    ‚Üì
PHASE 4: Page Assembly
    ‚Üì
PHASE 5: ITERATIVE Section Verification ‚Üê ‚Üê ‚Üê LOOP
    ‚îÇ                                           ‚îÇ
    ‚îú‚îÄ‚Üí For each section:                       ‚îÇ
    ‚îÇ     1. Scan section (screenshot)          ‚îÇ
    ‚îÇ     2. If issues ‚Üí FIX ‚Üí Re-scan          ‚îÇ
    ‚îÇ     3. If OK ‚Üí next section               ‚îÇ
    ‚îÇ                                           ‚îÇ
    ‚îî‚îÄ‚Üí ALL sections OK? ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí ‚îÇ
    ‚Üì                                           ‚îÇ
GATE 3: Final UIMatch                           ‚îÇ
    ‚Üì                                           ‚îÇ
    PASS? ‚Üí DONE ‚úì                              ‚îÇ
    FAIL? ‚Üí Analyze diff ‚Üí Fix ‚Üí ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚Üê ‚îò
```

**Each gate MUST PASS before proceeding. No exceptions.**

**KEY PRINCIPLE: Work per-section iteratively. Scan each section, fix issues, repeat until ALL sections pass.**

---

## PHASE 0: Component Inventory

**Purpose:** Extend existing shared components BEFORE creating anything new.

### Step 0.1: Read Component Mapping from Plan

```bash
# Find implementation plan
Glob: docs/plans/*-PAGENAME-implementation-plan.md

# Extract Component Mapping table:
# - REUSE actions (just import)
# - EXTEND actions (modify existing component)
# - CREATE actions (new page-specific component)
```

### Step 0.2: Process EXTEND Actions First

For EACH component marked as EXTEND:

```bash
# 1. Read existing component
Read: src/components/layout/Header.jsx

# 2. Read extension requirements from plan
# Example: "+centerLogo prop", "+variant='red'"

# 3. Modify the component to support new variant
Edit: src/components/layout/Header.jsx
# Add new props, conditional rendering, etc.
```

**Example - Extending Header.jsx:**

```jsx
// BEFORE
function Header({ variant = 'default' }) {
  return <header>...</header>;
}

// AFTER - with new props from plan
function Header({
  variant = 'default',    // existing
  centerLogo = false,     // NEW: from plan
}) {
  return (
    <header>
      {/* Existing left logo */}
      {!centerLogo && <Logo className="left-[68px]" />}

      {/* NEW: Center logo variant */}
      {centerLogo && (
        <div className="absolute left-1/2 -translate-x-1/2">
          <Logo />
        </div>
      )}
    </header>
  );
}
```

### Step 0.3: Verify Extensions Work

For EACH extended component:

```bash
# Create temporary test page
Write: src/pages/TestComponent.jsx

# Render component with NEW props
<Header centerLogo={true} variant="red" />

# Visual check: Does it render correctly?
# If not ‚Üí fix the extension
```

### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
### ‚ñ∂ GATE 0: COMPONENT EXTENSIONS VERIFICATION
### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**MUST PASS ALL checks before proceeding:**

- [ ] All EXTEND components modified
- [ ] New props documented in component
- [ ] Each extension tested (renders without errors)
- [ ] No duplicate components created (e.g., no ArticleHeader.jsx if Header.jsx extended)

**FAIL?** ‚Üí Fix extensions. Do NOT create duplicate components.

---

## PHASE 1: Preparation

### Step 1.1: Read Implementation Plan

```bash
# Find plan file
Glob: docs/plans/*-PAGENAME-implementation-plan.md

# Extract from plan:
- fileKey (e.g., "BDWqfvcMQw8RpFhMMMVRa3")
- nodeId (e.g., "32-563")
- Page structure and sections
```

### Step 1.2: Read UIMatch Config

```javascript
// Read config generated by /2-analyze-page
const configPath = "docs/uimatch-config.json";
const config = JSON.parse(Read({ file_path: configPath }));

// Verify config exists
if (!config || !config.meta) {
  throw new Error('‚ùå UIMatch config not found. Run /2-analyze-page first.');
}

// Extract sections in priority order (top to bottom)
const sections = config.sections;
const elements = config.elements;

// Display config summary
console.log(`‚úÖ Loaded config:`);
console.log(`   Total nodes: ${config.meta.totalNodes}`);
console.log(`   Sections: ${Object.keys(sections).length}`);
console.log(`   Elements: ${Object.keys(elements).length}`);

// Create ordered list of sections for generation
const sectionNames = Object.keys(sections);
console.log(`   Generation order: ${sectionNames.join(' ‚Üí ')}`);
```

### Step 1.3: Get Figma Metadata (for additional context)

```javascript
// Get node structure with POSITIONS
mcp__figma__get_metadata({
  fileKey: config.meta.figmaFileKey,
  nodeId: config.meta.pageNodeId
})
// Extract: x, y, width, height for ALL visual elements
```

**Config provides:**
- Section node IDs from `config.sections[name].nodeId`
- Element node IDs from `config.elements[name].nodeId`
- Asset manifests from `config.sections[name].assetManifest`
- Dimensions from `config.sections[name].dimensions`

---

## PHASE 2: Asset Extraction

### Step 2.1: Download All Assets

For EACH visual element identified in metadata:

```bash
# Get asset URL from Figma
mcp__figma__get_design_context({
  fileKey: "...",
  nodeId: "ELEMENT_NODE_ID"
})

# Download to local
curl -o public/assets/PAGE/element-name.svg "FIGMA_URL"
```

### Step 2.2: Create Asset Manifest

Document ALL assets with their Figma coordinates:

```markdown
## Asset Manifest - [PageName]

| Asset | Node ID | X | Y | W | H | File | Size |
|-------|---------|---|---|---|---|------|------|
| GADKI logo | 32:569 | 68 | 143 | 175 | 76 | gadki-logo.svg | 17974 |
| FDDS logo | 32:614 | 110 | 64 | 164 | 71 | fdds-logo.svg | 17966 |
```

### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
### ‚ñ∂ GATE 1: ASSET VERIFICATION
### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**MUST PASS ALL checks before proceeding:**

```bash
# Verify downloads
ls -la public/assets/PAGE/

# Check each file:
‚ñ° File exists
‚ñ° File size > 0 bytes
‚ñ° File size is UNIQUE (no duplicates)
```

**Verification Checklist:**
- [ ] All assets downloaded (count matches Figma)
- [ ] Each asset has UNIQUE file size
- [ ] All Node IDs documented
- [ ] All X, Y coordinates documented

**FAIL?** ‚Üí STOP. Report missing/duplicate assets. Do NOT proceed.

---

## PHASE 3: Per-Component Generation

**KEY PRINCIPLE:** Generate and verify EACH component separately before assembling the page.

### Step 3.1: Order Components for Generation

From Component Mapping, order by dependency:

```markdown
1. REUSE components - just import, no generation needed
2. Extended components - already done in PHASE 0
3. CREATE components - generate in order:
   - Independent components first (no deps)
   - Dependent components after
```

### Step 3.2: For Each CREATE Component

**LOOP through each CREATE component:**

#### 3.2.1: Get Component-Specific Figma Context

```javascript
// Get JUST this component's metadata
mcp__figma__get_metadata({
  fileKey: "...",
  nodeId: "COMPONENT_NODE_ID"  // Not full page!
})

// Get design context for component
mcp__figma__get_design_context({
  fileKey: "...",
  nodeId: "COMPONENT_NODE_ID"
})
```

#### 3.2.2: Generate Component with EXACT Positions

**CRITICAL RULE**: Use Figma coordinates EXACTLY.

```jsx
// From Figma: Node 32:569 at X=68, Y=143, W=175, H=76

// CORRECT ‚úì
<div className="absolute left-[68px] top-[143px] w-[175px] h-[76px]">
  <img src="/assets/page/gadki-logo.svg" />
</div>

// WRONG ‚úó - guessed position
<div className="absolute right-[68px] top-[143px]">
```

#### 3.2.3: Add Data Attributes for Verification

**CRITICAL:** Add both `data-section` AND `data-node-id` to enable automated verification.

```jsx
// Get nodeId from config
const nodeId = config.sections[sectionName].nodeId; // e.g., "50:64"

// Add BOTH attributes to section component
<section
  data-section="hero"
  data-node-id="50:64"
  className="..."
>
  {/* Component content */}
</section>
```

**For elements (logos, images):**
```jsx
// Get nodeId from config
const nodeId = config.elements['gadki-logo'].nodeId; // e.g., "2007:1192"

<img
  data-node-id="2007:1192"
  data-element="gadki-logo"
  src="/assets/gadki-logo.svg"
  alt="GADKI logo"
  className="..."
/>
```

**Rules:**
- `data-section`: Use for all section-level components
- `data-node-id`: Use for ALL elements (sections + images)
- Format: Use colon format from Figma (e.g., "50:64" not "50-64")

#### 3.2.4: Create Test Page for Component

```jsx
// src/pages/TestSection.jsx - temporary
import HeroSection from '../OKampanii/components/HeroSection';

function TestSection() {
  return (
    <div className="w-[1728px]">
      <HeroSection />
    </div>
  );
}
```

#### 3.2.5: Run UIMatch on COMPONENT ONLY

```bash
# Verify JUST this component against its Figma node
make verify-section SECTION=hero NODE_ID=XX-YY
```

### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
### ‚ñ∂ GATE 2: PER-COMPONENT VERIFICATION
### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**For EACH component, MUST PASS:**

- [ ] Component renders without errors
- [ ] Positions match Figma exactly
- [ ] UIMatch pixelDiffRatio ‚â§ 8% for this component
- [ ] data-section attribute present

**FAIL on any component?** ‚Üí Fix that component. Do NOT proceed to next component.

**ALL components pass?** ‚Üí Proceed to PHASE 4 (Page Assembly)

### Step 3.3: Build and Verify

```bash
npm run build  # Must succeed
npm run dev    # Start dev server
```

### Step 3.5: Update Config Implementation Status

**After all components generated**, update the config to mark them as implemented:

```bash
Bash({
  command: `node scripts/update-config-status.cjs`,
  description: "Update UIMatch config to mark implemented nodes"
})
```

**This script will:**
1. Launch browser and scan HTML for `data-node-id` attributes
2. Match against `docs/uimatch-config.json`
3. Update `implemented: false` ‚Üí `implemented: true` for found nodes
4. Update `config.meta.implementedNodes` count

**Verify update:**
```javascript
// Re-read config
const updated = JSON.parse(Read({ file_path: "docs/uimatch-config.json" }));

console.log(`‚úÖ Config updated:`);
console.log(`   Implemented: ${updated.meta.implementedNodes}/${updated.meta.totalNodes} nodes`);

// List implemented sections
const implSections = Object.entries(updated.sections)
  .filter(([_, s]) => s.implemented)
  .map(([name]) => name);
console.log(`   Sections: ${implSections.join(', ')}`);
```

---

## PHASE 4: Page Assembly

**Purpose:** Assemble all verified components into final page.

### Step 4.0: Assemble Page from Components

```jsx
// src/pages/OKampanii/index.jsx
import Header from '../../components/layout/Header';     // REUSE
import Footer from '../../components/layout/Footer';     // REUSE
import HeroSection from './components/HeroSection';      // CREATE (verified)
import ContentSection from './components/ContentSection'; // CREATE (verified)

function OKampanii() {
  return (
    <div className="w-[1728px] relative">
      <Header variant="article" centerLogo={true} />  {/* Extended */}
      <HeroSection />
      <ContentSection />
      <Footer />
    </div>
  );
}
```

**IMPORTANT:**
- Use extended components with NEW props (e.g., `centerLogo={true}`)
- Import verified components - don't rewrite them
- Maintain exact positioning from Figma

---

## PHASE 5: Iterative Section Verification

**Purpose:** Scan EACH section one-by-one, fix issues, repeat until ALL pass.

**CRITICAL:** This is an ITERATIVE process. Do NOT proceed until all sections pass.

### Step 5.0: Initial Section Scan

```bash
make verify-sections URL=http://localhost:5173/page-name
```

**Output:** `tmp/section-scans/[timestamp]/`
- `[section-name].png` - Screenshot of each section
- `full-page.png` - Full page screenshot
- `report.json` - All issues detected

### Step 5.1: Review Each Section Screenshot

**MANDATORY:** Read EVERY section screenshot, not just failed ones.

```bash
# Read each section screenshot
Read: tmp/section-scans/*/header.png
Read: tmp/section-scans/*/hero.png
Read: tmp/section-scans/*/materials.png
# ... etc for all sections
```

**Check visually for:**
- Layout issues not caught by automated checks
- Text truncation or wrapping problems
- Images clipped or positioned incorrectly
- Elements not matching Figma design

### Step 5.2: Fix Loop (Per-Section)

```
FOR EACH section with issues:
    1. Identify the issue from screenshot + report.json
    2. Fix the component code
    3. Re-run: make verify-sections URL=...
    4. Check ONLY that section's new screenshot
    5. If still has issues ‚Üí repeat from step 2
    6. If fixed ‚Üí move to next section

UNTIL all sections have no issues
```

**Common Issues and Fixes:**

| Issue | Likely Cause | Fix |
|-------|--------------|-----|
| ZERO_HEIGHT | Absolute children, no parent height | Add `h-[XXXpx]` to section |
| FLIPPED_IMAGE | CSS transform with -1 | Remove transform or fix asset |
| BROKEN_IMAGE | Wrong path or format | Check src path, file extension |
| DUPLICATE_IMAGE | Component rendered twice | Check imports and loops |
| Text truncated | Container too narrow | Increase width, check wrapping |
| Cards clipped | overflow:hidden + content exceeds | Increase section height or adjust content |

### Step 5.3: Verify All Sections Pass

```bash
make verify-sections URL=http://localhost:5173/page-name
```

**Expected output:**
```
‚úÖ ALL SECTIONS PASSED
```

**If ANY section still fails:** Go back to Step 5.2.

---

## PHASE 6: Final Verification

### Loop Variables
```
iteration = 0
MAX_ITERATIONS = 5
```

### LOOP START

#### Step 6.1: Run Element Verification

```bash
make verify-elements URL=http://localhost:5173/page-name
```

**If FAIL:** Fix structural issues before continuing.

#### Step 6.2: Run Asset Verification

**Check for flipped/rotated images and transforms:**

```bash
make verify-assets URL=http://localhost:5173/page-name
```

**Checks performed:**
- **CSS transforms** - Detects scaleX(-1), scaleY(-1), rotate (flipped logos!)
- **Aspect ratio distortion** - Images stretched >20%
- **Logo validation** - Known assets checked against expected properties
- **Screenshot capture** - Logos captured for manual orientation review

**If FAIL:**
- Check image src - is it the correct file?
- Check CSS transforms on parent elements
- Compare captured screenshots with Figma

#### Step 6.3: Run Cross-Page Consistency Check

```bash
make verify-consistency
```

**If FAIL:** Fix component consistency issues.

#### Step 6.4: Run Full-Page UIMatch

```bash
make verify NODE_ID=XX-YY
```

#### Step 6.5: Read Report

```bash
Read: tmp/uimatch-reports/report.json
```

#### Step 6.6: MANDATORY - Analyze diff.png

**CRITICAL: ALWAYS read diff.png, even if Quality Gate passed.**

```bash
Read: tmp/uimatch-reports/diff.png
```

For EACH red/orange highlighted area:

1. **Identify**: What element is highlighted?
2. **Compare**: Look at impl.png vs figma.png
3. **Categorize**:
   - **STRUCTURAL**: Wrong position, wrong size, missing element, z-index issue
   - **FONT**: Text anti-aliasing, slight weight difference (~5%)

Document findings:
```markdown
## diff.png Analysis - Iteration [N]

| Area | Element | Category | Issue | Fix |
|------|---------|----------|-------|-----|
| Top-left | Logo | STRUCTURAL | Wrong X position | Change left-[100px] to left-[68px] |
| Center | Title | FONT | Anti-aliasing | Acceptable |
```

### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
### ‚ñ∂ GATE 3: FINAL VERIFICATION
### ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**MUST PASS ALL checks:**

**Section Verification (Phase 5):**
- [ ] All sections have screenshots
- [ ] All sections visually reviewed
- [ ] No ZERO_HEIGHT sections
- [ ] No FLIPPED_IMAGE issues
- [ ] No visual layout problems

**Element Verification (Step 6.1):**
- [ ] No duplicate images in sections
- [ ] No overlapping elements
- [ ] No broken assets

**Asset Verification (Step 6.2):**
- [ ] No flipped/rotated images
- [ ] Logo orientation correct

**Cross-Page Consistency (Step 6.3):**
- [ ] Header same size on all pages
- [ ] Footer same size on all pages
- [ ] Hamburger menu consistent
- [ ] Shared components identical

**UIMatch (Step 6.4-6.6):**
- [ ] `qualityGate.pass` = true
- [ ] `pixelDiffRatio` ‚â§ 8%
- [ ] NO STRUCTURAL issues in diff.png (only FONT acceptable)
- [ ] All components render correctly in context

#### If PASS:
```
Break loop ‚Üí Update status ‚Üí DONE ‚úì
```

#### If FAIL + STRUCTURAL issues:
```
iteration++

if iteration > MAX_ITERATIONS:
    Ask user: "5 attempts failed. Options:"
    - Continue trying
    - Accept current state
    - Manual intervention

else:
    Apply targeted fixes based on diff.png analysis
    Continue loop
```

#### If FAIL + Only FONT issues:
```
Log: "Only font rendering differences remain (acceptable)"
Consider PASS ‚Üí Update status ‚Üí DONE ‚úì
```

### LOOP END

---

## After Completion

Update `docs/implementation-status.md`:

```markdown
### [PageName] - ‚úÖ Complete

**UIMatch Results:**
- Quality Gate: PASS
- DFS Score: [XX]/100
- Pixel Diff Ratio: [X.XX]%
- Iterations: [N]

**Generated:**
- src/pages/[PageName]/ - [X] files
- public/assets/[page]/ - [Y] assets

**Verification:**
- [x] Gate 0: Component Extensions - PASS
- [x] Gate 1: Asset Verification - PASS
- [x] Gate 2: Per-Component Verification - PASS
- [x] Phase 5: Iterative Section Verification - PASS
- [x] Gate 3: Final UIMatch - PASS
```

---

## Output Summary

```
‚úÖ Code generation complete!

üìä Results:
- Quality Gate: PASS
- DFS Score: [XX]/100
- Iterations: [N]

üö™ Gates Passed:
- [x] Gate 0: Component Extensions
- [x] Gate 1: Asset Verification
- [x] Gate 2: Per-Component Verification
- [x] Phase 5: Iterative Section Verification
- [x] Gate 3: Final UIMatch

üìÅ Generated:
- src/pages/[PageName]/
- public/assets/[page]/

üìã Reports:
- tmp/uimatch-reports/report.json
- tmp/uimatch-reports/diff.png

üöÄ Next: /4-refine-code (optional polish)
```

---

## Error Reference

### Gate 0 Failures (Component Extensions)
| Issue | Solution |
|-------|----------|
| Created duplicate component | Delete duplicate, extend existing with props |
| Extension broke existing pages | Add prop with default value to maintain backwards compatibility |
| Missing component mapping | Re-run /2-analyze-page to generate mapping |

### Gate 1 Failures
| Issue | Solution |
|-------|----------|
| File size = 0 | Re-download from Figma API |
| Duplicate file sizes | Wrong Node IDs - verify each asset has unique node |
| Missing coordinates | Re-run get_metadata for element |

### Gate 2 Failures (Per-Component Verification)
| Issue | Solution |
|-------|----------|
| Guessed position | Replace with exact X,Y from Figma metadata |
| Missing data-section | Add to component wrapper |
| Component fails UIMatch | Fix component BEFORE assembling page |
| Component renders incorrectly | Check props, check Figma node ID |

### Gate 3 Failures (Full Page UIMatch)
| Issue | Solution |
|-------|----------|
| STRUCTURAL in diff.png | Fix position/size using Figma coordinates |
| Duplicate/overlapping elements | Check for duplicate imports, duplicate components |
| High pixelDiffRatio | Check for missing elements or wrong layout |
| Components don't align | Check relative positioning in page assembly |
| 5+ iterations | Ask user for guidance |

---

## Key Rules

1. **REUSE before CREATE**: Always check Component Mapping - extend existing components, don't duplicate
2. **EXACT coordinates**: Always use Figma's x,y,width,height
3. **Per-component verification**: Verify each component BEFORE assembling page
4. **NO duplicate components**: Never create HeaderVariant.jsx, ArticleHeader.jsx, etc. - use props on existing
5. **Verify assets**: Unique file sizes = unique assets
6. **Read diff.png**: Quality Gate pass is NOT enough
7. **STRUCTURAL vs FONT**: Only font differences are acceptable
8. **Max 5 iterations**: Escalate to user after 5 failures
9. **Document everything**: Asset Manifest, diff.png analysis

$ARGUMENTS
