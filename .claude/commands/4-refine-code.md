---
description: Polish and optimize Claude-generated React code
---

# Refine Generated Code

Analyze and refine code generated by `/3-generate-code` to production quality.

**Transforms:** Working code â†’ Production-ready code

---

## Arguments

- **Page Name** (optional): Specific page to refine (e.g., "Homepage")
  - If omitted: Auto-detects from `implementation-status.md` current step

## Instructions

Use the **code-refiner agent** to polish generated code.

### Prerequisites

Before running this command:
1. âœ… `/3-generate-code` completed â†’ code exists in `src/pages/[PageName]/`
2. âœ… Code runs successfully with `npm run dev`
3. âœ… Basic visual check completed (no major issues)

### Steps

**Step 1: Determine Page to Refine**
```bash
# Option A: User provides page name
PageName = $ARGUMENT[0] || detect from current step

# Option B: Auto-detect from implementation-status.md
Glob: docs/**/implementation-status.md
Read: Find "Current Step" section
Extract: Page name from workflow
```

**Step 2: Read Generated Code**
```bash
# Find all generated files
Glob: src/pages/${PageName}/**/*.{jsx,tsx}
# Read each file
# Measure: total lines, component count
```

**Step 3: Invoke code-refiner Agent**

Use Task tool to launch the agent:
```javascript
Task({
  subagent_type: "code-refiner",
  description: `Refine React code for ${PageName}`,
  prompt: `
Analyze and refine the generated code for ${PageName} page.

Context:
- Generated code location: src/pages/${PageName}/
- Implementation plan: ${planPath}
- Project: React ${reactVersion} + Vite + Tailwind CSS

Tasks:
1. Analyze code quality
2. Identify refinement opportunities:
   - Component size (split if >200 lines)
   - Hardcoded values â†’ design tokens
   - Missing accessibility (alt text, ARIA)
   - Missing type safety (PropTypes)
   - Performance optimizations
   - Component reuse opportunities
3. Create refinement plan with priorities
4. Execute refinements systematically
5. Verify changes (npm run lint, visual check)
6. Generate refactoring report
7. Update implementation-status.md

Quality Goals:
- âœ… Accessibility: 100/100
- âœ… Design tokens: 95/100
- âœ… Type safety: 95/100
- âœ… Performance: 90/100
- âœ… Maintainability: 92/100
- ğŸ¯ Overall: A grade (90+)

Output:
- Polished code in src/
- Extracted shared components (if first page)
- Updated tailwind.config.js (design tokens)
- Refactoring reports in docs/
- Updated implementation-status.md
`
});
```

**Step 4: Track Refinements**

Agent uses TodoWrite to track each refinement:
```javascript
TodoWrite([
  { content: "Analyze code quality", status: "completed" },
  { content: "Add missing alt text (3 images)", status: "in_progress" },
  { content: "Extract design tokens to tailwind.config", status: "pending" },
  { content: "Split large components (HeroSection: 245 lines)", status: "pending" },
  { content: "Extract shared components (Header, Footer)", status: "pending" },
  { content: "Add PropTypes to all components", status: "pending" },
  { content: "Optimize images (lazy loading)", status: "pending" },
  { content: "Generate refactoring report", status: "pending" }
]);
```

**Step 5: Verify Refinements**

After agent completes:
```bash
# Check for syntax errors
Bash: npm run lint

# Test app still runs
Bash: npm run dev
# Quick browser check at http://localhost:5173/

# Review generated reports
Glob: docs/**/refactoring/${date}-${PageName}-*.md
```

**Step 6: Update Implementation Status**

```markdown
## Workflow Progress

### Current Step: âœ… Code Refined - Production Ready

**Completed:**
- âœ… Phase 0: Full project analysis
- âœ… Phase 1: ${PageName} analysis
- âœ… Phase 2: ${PageName} code generation
- âœ… Phase 3: ${PageName} code refinement

**Refinement Results:**
- 7 improvements applied
- 4 components extracted
- 12 files modified
- Quality: B+ (85) â†’ A (94) âœ… +9 points

**Quality Scores:**
- Accessibility: 100/100 âœ…
- Design tokens: 95/100 âœ…
- Type safety: 95/100 âœ…
- Performance: 90/100 âœ…
- Maintainability: 92/100 âœ…

**Next Steps:**
1. Visual comparison: /5-compare-existing (optional)
2. Move to next page: /2-analyze-page [NextPage]
3. Or commit changes: git add . && git commit -m "feat: implement ${PageName}"
```

### Output

Agent produces:

**Modified Code:**
```
src/
â”œâ”€â”€ components/                        # âœ¨ Shared components extracted
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ Header.jsx                 # âœ¨ Extracted (if first page)
â”‚   â”‚   â””â”€â”€ Footer.jsx                 # âœ¨ Extracted (if first page)
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ Button.jsx                 # âœ¨ Extracted (if first page)
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ ${PageName}/
â”‚       â”œâ”€â”€ index.jsx                  # âœ… Refined
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ HeroSection.jsx        # âœ… Simplified (split)
â”‚       â”‚   â”œâ”€â”€ HeroBackground.jsx     # âœ¨ Extracted sub-component
â”‚       â”‚   â”œâ”€â”€ HeroContent.jsx        # âœ¨ Extracted sub-component
â”‚       â”‚   â””â”€â”€ ...                    # âœ… All refined
â”‚       â””â”€â”€ README.md                  # âœ… Updated
â””â”€â”€ tailwind.config.js                 # âœ… Design tokens added
```

**Documentation:**
```
docs/gadki/
â””â”€â”€ refactoring/
    â”œâ”€â”€ 2025-11-24-${PageName}-analysis.md
    â”œâ”€â”€ 2025-11-24-${PageName}-refactoring-plan.md
    â””â”€â”€ 2025-11-24-${PageName}-refactoring-report.md
```

### Refinement Checklist

Agent systematically applies:

#### Critical Fixes (Must Complete)
- [ ] Add missing alt text for all images
- [ ] Fix ARIA label issues
- [ ] Ensure proper heading hierarchy (h1 â†’ h2 â†’ h3)
- [ ] Verify color contrast (4.5:1 for text)

#### High Priority (Should Complete)
- [ ] Extract design tokens to tailwind.config.js
- [ ] Split large components (>200 lines)
- [ ] Extract shared components (Header, Footer, Button)
- [ ] Add PropTypes to all components
- [ ] Fix hardcoded values

#### Medium Priority (Nice to Have)
- [ ] Optimize images (lazy loading, responsive)
- [ ] Add JSDoc documentation
- [ ] Improve performance (React.memo, code splitting)
- [ ] Enhance error handling

#### Low Priority (Optional)
- [ ] Add unit tests
- [ ] Add Storybook stories
- [ ] Performance monitoring setup

### Error Handling

**Error 1: Code Not Found**
```
Error: No generated code found for ${PageName}
Solution: Run /3-generate-code first
```

**Error 2: Lint Errors After Refinement**
```
Error: npm run lint failed
Solution:
1. Agent reviews lint errors
2. Fixes automatically if possible
3. Reports errors if manual intervention needed
```

**Error 3: App Doesn't Run After Refinement**
```
Error: npm run dev failed
Solution:
1. Agent reverts last change
2. Re-attempts refinement with different approach
3. Reports issue if unresolvable
```

### After Completion

Inform user:
```
âœ… Code refinement complete!

ğŸ“Š Refinement Results:
- 7 improvements applied
- 4 components extracted
- 12 files modified
- Quality score: B+ (85) â†’ A (94) âœ… +9 points

ğŸ“ˆ Quality Improvements:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Category        â”‚ Before â”‚ After  â”‚ Change   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Accessibility   â”‚ 95     â”‚ 100    â”‚ +5 âœ…    â”‚
â”‚ Design tokens   â”‚ 70     â”‚ 95     â”‚ +25 âœ…   â”‚
â”‚ Type safety     â”‚ 85     â”‚ 95     â”‚ +10 âœ…   â”‚
â”‚ Performance     â”‚ 80     â”‚ 90     â”‚ +10 âœ…   â”‚
â”‚ Maintainability â”‚ 75     â”‚ 92     â”‚ +17 âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‚ Files Modified:
Created:
- src/components/layout/Header.jsx (extracted)
- src/components/layout/Footer.jsx (extracted)
- src/pages/${PageName}/components/HeroBackground.jsx (split)
- src/pages/${PageName}/components/HeroContent.jsx (split)

Modified:
- tailwind.config.js (+10 design tokens)
- src/pages/${PageName}/index.jsx (imports updated)
- src/pages/${PageName}/components/HeroSection.jsx (simplified)
- src/pages/${PageName}/components/ContentSection.jsx (PropTypes)
- ... (12 files total)

ğŸ“‹ Reports Saved:
- docs/gadki/refactoring/2025-11-24-${PageName}-analysis.md
- docs/gadki/refactoring/2025-11-24-${PageName}-refactoring-plan.md
- docs/gadki/refactoring/2025-11-24-${PageName}-refactoring-report.md

âœ… Code is production-ready!

ğŸ’» Test:
   npm run dev
   Open http://localhost:5173/

ğŸ” Visual validation:
   Compare with Figma screenshot
   Test responsive behavior (mobile, tablet, desktop)

ğŸš€ Next steps:
   Option 1: /5-compare-existing (validate against Figma)
   Option 2: /2-analyze-page [NextPage] (move to next page)
   Option 3: git commit (commit changes)
```

---

## Examples

### Example 1: Refine Current Page (Auto-detect)
```bash
/4-refine-code
```
Reads `implementation-status.md` to find current page, refines code automatically.

### Example 2: Refine Specific Page
```bash
/4-refine-code Homepage
```
Refines Homepage code (regardless of current step).

---

## Notes

- **Quality over speed**: Take time to do refinements properly
- **Incremental approach**: Start with critical fixes, then optimize
- **Don't over-engineer**: Only extract components if they'll be reused
- **Preserve working code**: Never break functionality while refining
- **Document decisions**: Explain why certain patterns were chosen in reports

---

## Workflow Integration

**This command is part of the new Figma â†’ React workflow:**

1. `/1-analyze-project` - Full project discovery
2. `/2-analyze-page` - Analyze single page
3. `/3-generate-code` - Generate React code
4. **`/4-refine-code`** â¬…ï¸ YOU ARE HERE
5. `/5-compare-existing` - Compare with Figma (optional)

**Dependencies:**
- Requires: Generated code from `/3-generate-code`
- Produces: Production-ready code ready for commit

$ARGUMENTS
